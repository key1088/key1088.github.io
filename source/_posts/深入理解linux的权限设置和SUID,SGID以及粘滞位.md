title: 深入理解linux的权限设置和SUID,SGID以及粘滞位
categories: [Linux]
tags: []
date: 2010-05-25 09:43:00
---
<p>我们知道文件的权限可以用三个八进制数字表示。其实文件的权限应该用四个八进制来表示，不过用 ls -l  命令时，只显示三个罢了。那个没有显示的八进制数字其实是第一个，它用来设定一些特殊权限。这个八进制数字的三个位是：</p><p>&#160;&#160;&#160;&#160;  SUID SGID sticky-bit</p><p>&#160;&#160;&#160;&#160; 它们的含义是： <br />SUID</p><p><br />当设置了</p><p>SUID 位的文件被执行时，该文件将以所有者的身份运行，也就是说无论谁来执行这个文件，他都有文件所有者的特权。如果所有者是 root  的话，那么执行人就有超级用户的特权了。这时该位将变成一个安全漏洞，因此不要轻易设置该位。 <br />sticky-bit</p><p>sticky   位要求操作系统既是在可执行程序退出后，仍要在内存中保留该程序的映象。这样做是为了节省大型程序的启动时间。但是会占用系统资源。因此设置该位，不如把 程序写好。</p><p>&#160;</p><p><br />每一个文件有所有者及组编号，set uid ；set  gid可以改变用户对文件具有的权限：写和执行.</p><p>setuid: 在执行时具有文件所有者的权限. <br />setgid: 设置目录.  一个目录被标上setgid位,此目录下创建的文件继承该目录的属性. <br />sticky bit: 该位可以理解为防删除位. 设置sticky  bit位后，就算用户对目录具有写权限，但也只能添加文件而不能删除文件。</p><p><br />如何设置：</p><p>操作这些标志与操作文件 权限的命令是一样的, 都是 chmod. 有两种方法来操作, <br />1) chmod u+s temp --  为temp文件加上setuid标志. (setuid 只对文件有效，U=用户) <br />chmod g+s tempdir --  为tempdir目录加上setgid标志 (setgid 只对目录有效，g=组名) <br />chmod o+t temp --  为temp文件加上sticky标志 (sticky只对文件有效)</p><p>2) 采用八进制方式. 这一组八进制数字三位的意义如下, <br />abc  <br />a - setuid位, 如果该位为1, 则表示设置setuid <br />b - setgid位, 如果该位为1,  则表示设置setgid <br />c - sticky位, 如果该位为1, 则表示设置sticky</p><p>rwsrw-r--  表示有setuid标志 (rwxrw-r--:rwsrw-r--)<br />rwxrwsrw- 表示有setgid标志  (rwxrwxrw-:rwxrwsrw-)<br />rwxrw-rwt 表示有sticky标志 (rwxrw-rwx:rwxrw-rwt)</p><p>理解文件权限</p><p>所谓的文件权限，是指对文件的访问权限，包括对文件的读、写、删除、执行。Linux  是一个多用户操作系统，它允许多个用户同时登录和工作。因此 Linux 将一个文件或目录与一个用户和组联系起来。请看下面的例子：</p><p>&#160;&#160;&#160;&#160;  drwxr-xr-x 5 root root 1024 Sep 13 03:27 Desktop</p><p>&#160;&#160;&#160;&#160;  与文件权限相关联的是第一、第三、第四个域。第三个域是文件的所有者，第四个域是文件的所属组，而第一个域则限制了文件的访问权限。在这个例子中，文件的  所有者是 root，所属的组是 root，文件的访问权限是  drwxr-xr-x。对于文件和目录讲，每个文件和目录都有一组权限标志和它们结合在一起，在上例中就是第一个域中的内容。下面来仔细分析这个域中各个  符号的意义：</p><p>&#160;&#160;&#160;&#160; 该域由 10 个字符组成，可以把它们分为四组，具体含义分别是：</p><p>&#160;&#160;&#160;&#160; d rwx  r-x r-x</p><p>&#160;&#160;&#160;&#160; 文件类型 所有者权限标志 组权限标志 其他用户权限标志</p><p>&#160;&#160;&#160;&#160; 其中：</p><p>&#160;&#160;&#160;&#160;  文件类型：第一个字符。由于 Linux 系统对与设备、目录、文件都当作是文件来处理，因此该字符表明此文件的类型，字符与对应的意义如下表：</p><p>&#160;&#160;&#160;&#160; 权限标志：</p><p>&#160;&#160;&#160;&#160; 对每个文件或目录都有 4  类不同的用户。每类用户各有一组读、写和执行（搜索）文件的访问权限，这 4 类用户是：</p><p>&#160;&#160;&#160;&#160; root：系统特权用户类，既  UID = 0 的用户。</p><p>&#160;&#160;&#160;&#160; owner：拥有文件的用户。</p><p>&#160;&#160;&#160;&#160;  group：共享文件的组访问权限的用户类的用户组名称。</p><p>&#160;&#160;&#160;&#160; world：不属于上面 3 类的所有其他用户。</p><p>&#160;&#160;&#160;&#160;  作为  root，他们自动拥有了所有文件和目录的全面的读、写和搜索的权限，所以没有必要明确指定他们的权限。其他三类用户则可以在耽搁文件或者目录的基础上别  授权或撤消权限。因此对另外三类用户，一共 9 个权限位与之对应，分为 3 组，每组 3 个，分别用 r、w、x 来表示，分别对应  owner、group、world。</p><p>&#160;&#160;&#160;&#160; 权限位对于文件和目录的含义有些许不同。每组 3  个字符对应的含义从左至右的顺序，对于文件来说是：读文件的内容（r）、写数据到文件（w）、做为命令执行该文件（x）。对于目录来说是：读包含在目录中  的文件名称（r）、写信息到目录中去（增加和删除索引点的连接）、搜索目录（能用该目录名称作为路径名去访问它所包含的文件或子目录）。具体来说就是：</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1． 有只读权限的用户不能用 cd 进入该目录；还必须有执行权限才能进入。</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;  2． 有执行权限的用户只有在知道文件名并拥有该文件的读权限的情况下才可以访问目录下的文件。</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 3．  必须有读和执行权限才可以使用 ls 列出目录清单，或使用 cd 进入目录。</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4．  如用户有目录的写权限，则可以创建、删除或修改目录下的任何文件或子目录，既是该文件或子目录属于其他用户。</p><p>修改文件权限</p><p>&#160;&#160;&#160;&#160;  首先讲修改文件的所有权，使用 chown 和 chgrp 命令：</p><p>&#160;&#160;&#160;&#160; chown new_user file or  directory：修改文件或目录的所有者。</p><p>&#160;&#160;&#160;&#160; chgrp new_group file or  directory：修改文件或目录的所属组。</p><p>&#160;&#160;&#160;&#160; 这里需要注意的是：普通用户不能将文件或目录的所有权交与他人，只有  root 有这一权限。但是普通用户有权改变文件或目录的所属组。</p><p><br />由于每类用户的权限都是由 rwx  三位组成，因此可以用三个八进制数字表示文件的访问权。一个八进制数字可以用三个二进制数字表示，那么与其对应，权值为 4 的位对应 r，权值为 2  的位对应 w，权值为 1 的位对应 x。对于一类用户，将这三位与其对应的权值相乘求和，就可以得出对该类用户的访问权限。</p><p>&#160;&#160;&#160;&#160;  改变文件访问权限的命令是 chmod，格式是：</p><p>&#160;&#160;&#160;&#160; chmod permission file_name</p><p>&#160;&#160;&#160;&#160;  比如 chmod 764  a.txt,它表示对于文件的所有者，具有对该文件读、写、执行的权限。对于文件所属组的用户，拥有读、写的权限。对于其他用户，只有读权限。</p><p>&#160;&#160;&#160;&#160; 这里需要注意的是：文件的创建者是唯一可以修改该文件访问权限的普通用户，另外一个可以修改文件访问权限的用户是 root。</p><p>&#160;&#160;&#160;&#160; 还有一种表示方法，就是用字符串来设定文件访问权限。其中读用 r 表示，写用 w 表示，执行用 x 表示；所有者用 u  表示，组用户用 g 表示，其他用户用 o 表示，所有用户用 a 表示。那么上面例子就写成西面的模样：</p><p>chmod  a+r,u+w,u+x,g+w a.txt</p><p> </p><p> </p>