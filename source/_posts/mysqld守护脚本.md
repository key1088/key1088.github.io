title: mysqld守护脚本
categories: [Mysql]
tags: []
date: 2011-04-28 16:23:00
---
#!/bin/sh<br />#This is check msyqld shell<br />#by:key1088@163.com<br />#守护mysqld脚本，防止意外崩溃。
#如果连接启动10次，依旧启动不来了。停止（可以写成运行某个程序），解决内存。
&nbsp;
<strong>ERRLOG=/videodata/mysqldata/data/CHINASOFT.err<br />load_mysqld ()<br />{<br />/etc/init.d/mysqld start<br />}<br /><br />while&nbsp; true<br />do<br />&nbsp; i=1<br />&nbsp; PRO=<code>ps aux|grep mysqld|grep -v grep</code><br />&nbsp; if [ -z &quot;$PRO&quot; ]<br />&nbsp; then<br />&nbsp; &nbsp;&nbsp;&nbsp; while true<br />&nbsp; &nbsp;&nbsp;&nbsp; do<br />&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if [ -z &quot;$PRO&quot; ]<br />&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; then<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; load_mysqld<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; echo &quot;<code>date +'%y%m%d %H:%M:%S'</code>&nbsp;&nbsp; $0 LOAD MSYQLD-[$i]&quot; &gt;&gt; $ERRLOG<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; sleep 20<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; PRO=<code>ps aux|grep mysqld|grep -v grep</code><br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if [ -z &quot;$PRO&quot; ]<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; then&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; i=$((i+1))<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; fi<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; break<br />&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; fi<br />&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if [ $i -eq 10 ]<br />&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; then<br />&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; echo &quot;<code>date +'%y%m%d %H:%M:%S'</code> HR_MYSQL_SAFE.SH LOAD MSQQLD --STOP&quot; &gt;&gt; $ERRLOG<br />&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; exit 1<br />&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; fi<br />&nbsp; &nbsp;&nbsp;&nbsp; done<br />&nbsp; fi<br />&nbsp; sleep 20<br />done</strong>