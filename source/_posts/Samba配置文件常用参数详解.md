title: Samba配置文件常用参数详解
categories: [Linux]
tags: []
date: 2010-05-30 10:41:00
---
转自 : <a href="http://yuanbin.blog.51cto.com/363003/115761">http://yuanbin.blog.51cto.com/363003/115761</a><br />Samba的主配置文件叫smb.conf，默认在/etc/samba /目录下。smb.conf含有多个段，每个段由段名开始，直到下个段名。每个段名放 在方括号中间。每段的参数的格式是：名称=指。配置文件中一行一个段名和参数，段名和参数名不分大小写。除了[global]段外，所有的段都可以看作是一个共享资源。段名是该共 享资源的名字，段里的参数是该共享资源的属性。Samba安装好后，使用testparm命令可以测试smb.conf配 置是否正确。使用<strong>testparm –v</strong>命令可以详细的列出smb.conf支持的配置参数。 <strong>全局参数：</strong>==================Global Settings  ===================<strong>[global]</strong> <strong>config file =  /usr/local/samba/lib/smb.conf.%m</strong>说明：config  file可以让你使用另一个配置文件来覆盖缺省的配置文件。如果文件  不存在，则该项无效。这个参数很有用，可以使得samba配置更灵活，可以让一台samba服务器模拟多台不同配置的服务器。比如，你想让PC1（主机 名）这台电脑在访问Samba  Server时使用它自己的配置文件，那么先在/etc/samba/host/下为PC1配置一个名为smb.conf.pc1的文件，然后在 smb.conf中加入：config file = /etc/samba/host/smb.conf.%m。这样当PC1请求连接Samba  Server时，smb.conf.%m就被替换成smb.conf.pc1。这样，对于PC1来说，它所使用的Samba服务就是由 smb.conf.pc1定义的，而其他机器访问Samba Server则还是应用smb.conf。 <strong>workgroup = WORKGROUP </strong>说明：设定 Samba Server 所要加入的工作组或者域。 <strong>server string = Samba  Server Version %v</strong>说明：设定 Samba Server  的注释，可以是任何字符串，也可以不填。宏%v表示显示Samba的版本号。 <strong>netbios name = smbserver</strong>说明：设置Samba  Server的NetBIOS名称。如果不填，则默认会使用该服务器的DNS名称的第一部分。netbios  name和workgroup名字不要设置成一样了。 <strong>interfaces = lo eth0  192.168.12.2/24 192.168.13.2/24 </strong>说明：设置Samba  Server监听哪些网卡，可以写网卡名，也可以写该网卡的IP地址。 <strong>hosts allow = 127.  192.168.1. 192.168.10.1</strong>说明：表示允许连接到Samba  Server的客户端，多个参数以空格隔开。可以用一个IP表示，也可以用一个网段表示。hosts deny 与hosts allow 刚好相反。例如：hosts  allow=172.17.2.EXCEPT172.17.2.50表示容许来自172.17.2.*.*的主机连接，但排除 172.17.2.50hosts allow=172.17.2.0/255.255.0.0表示容许来自172.17.2.0/255.255.0.0子网中的所有主 机连接hosts allow=M1，M2表示容许来自M1和M2两台计算机连接hosts allow=@xq表示容许来自XQ网域的所有计算机连接 <strong>max connections = 0</strong>说明：max connections用来指定连接Samba  Server的最大连接数目。如果超出连接数目，则新的连接请求将被拒绝。0表示不限制。 <strong>deadtime = 0</strong>说明：deadtime用来设置断掉一个没有打开任何文件的连接的时间。单 位是分钟，0代表Samba Server不自动切断任何连接。 <strong>time server = yes/no</strong>说明：time  server用来设置让nmdb成为windows客户端的时间服务器。 <strong>log file =  /var/log/samba/log.%m</strong>说明：设置Samba  Server日志文件的存储位置以及日志文件名称。在文件名后加个宏%m（主机名），表示对每台访问Samba  Server的机器都单独记录一个日志文件。如果pc1、pc2访问过Samba  Server，就会在/var/log/samba目录下留下log.pc1和log.pc2两个日志文件。 <strong>max log size = 50</strong>说明：设置Samba  Server日志文件的最大容量，单位为kB，0代表不限制。 <strong>security = user </strong>说明：设置用户访问Samba  Server的验证方式，一共有四种验证方式。<strong>1. </strong><strong>share</strong><strong>：</strong>用 户访问Samba Server不需要提供用户名和口令, 安全性能较低。<strong>2. </strong><strong>user：</strong>Samba  Server共享目录只能被授权的用户访问,由Samba Server负责检查账号和密码的正确性。账号和密码要在本Samba  Server中建立。<strong>3. </strong><strong>server：</strong>依 靠其他Windows NT/2000或Samba  Server来验证用户的账号和密码,是一种代理验证。此种安全模式下,系统管理员可以把所有的Windows用户和口令集中到一个NT系统上,使用 Windows NT进行Samba认证, 远程服务器可以自动认证全部用户和口令,如果认证失败,Samba将使用用户级安全模式作为替代的方式。<strong>4. </strong><strong>domain：</strong>域 安全级别,使用主域控制器(PDC)来完成认证。 <strong>passdb backend = tdbsam</strong>说明：passdb  backend就是用户后台的意思。目前有三种后台：smbpasswd、tdbsam和ldapsam。sam应该是security account  manager（安全账户管理）的简写。<strong>1.smbpasswd：</strong>该方式是使用 smb自己的工具smbpasswd来给系统用户（真实用户或者虚拟用户）设置一个Samba密码，客户端就用这个密码来访问 Samba的资源。smbpasswd文件默认在/etc/samba目录下，不过有时候要手工建立该文件。<strong>2.tdbsam</strong><strong>：</strong>该 方式则是使用一个数据库文件来建立用户数据库。数据库文件叫passdb.tdb，默认在/etc/samba目录下。passdb.tdb用户数据库可 以使用smbpasswd –a来建立Samba用户，不过要建立的Samba用户必须先是系统用户。我们也可以使用<strong>pdbedit</strong>命 令来建立Samba账户。pdbedit命令的参数很多，我们列出几个主要的。pdbedit –a username：新建Samba账户。pdbedit –x username：删除Samba账户。pdbedit  –L：列出Samba用户列表，读取passdb.tdb数据库文件。pdbedit –Lv：列出Samba用户列表的详细信息。pdbedit –c “[D]” –u  username：暂停该Samba用户的账号。pdbedit –c “[]” –u  username：恢复该Samba用户的账号。<strong>3.ldapsam</strong><strong>：</strong>该 方式则是基于LDAP的账户管理方式来验证用户。首先要建立LDAP服务，然后设置“passdb backend =  ldapsam:ldap://LDAP Server” <strong>encrypt passwords = yes/no</strong>说明：是否将认证密码加密。因为现在windows操作系统都是使用加密密 码，所以一般要开启此项。不过配置文件默认已开启。 <strong>smb passwd file =  /etc/samba/smbpasswd</strong>说明：用来定义samba用户的密码文件。smbpasswd文件如果没有 那就要手工新建。 <strong>username map =  /etc/samba/smbusers</strong>说明：用来定义用户名映射，比如可以将root换成 administrator、admin等。不过要事先在smbusers文件中定义好。比如：root = administrator  admin，这样就可以用administrator或admin这两个用户来代替root登陆Samba  Server，更贴近windows用户的习惯。 <strong>guest account = nobody</strong>说明：用来设置guest用户名。 <strong>socket options =  TCP_NODELAY SO_RCVBUF=8192 SO_SNDBUF=8192</strong>说明：用来设置服务器和客户端之间会话的Socket选项，可以优化传输速 度。 <strong>domain master = yes/no </strong>说明：设置Samba服务器是否要成为网域主浏览器，网域主浏览器可以管理 跨子网域的浏览服务。 <strong>local master = yes/no</strong>说明：local master用来指定Samba  Server是否试图成为本地网域主浏览器。如果设为no，则永远不会成为本地网域主浏览器。但是即使设置为yes，也不等于该Samba  Server就能成为主浏览器，还需要参加选举。 <strong>preferred master = yes/no</strong>说明：设置Samba  Server一开机就强迫进行主浏览器选举，可以提高Samba  Server成为本地网域主浏览器的机会。如果该参数指定为yes时
