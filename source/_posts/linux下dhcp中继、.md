title: linux下dhcp中继、
categories: [Linux]
tags: []
date: 2010-05-28 10:08:00
---
DHCP的中继。<br />为何不能跨网段。。<br />我们都知道，在LAN中动态分配IP需要DHCP。但是DHCP的所有信息都是以广播的形式传送的，所以无法通过路由器，这就决定了一台DHCP服务<br /><br />器只能对本网段的客户机分配IP地址，如果要用一台DHCP服务器给不同的网段分配IP，需要在此网段设置一台DHCP中继代理。安装了Linux系<br /><br />统的机器经过设置是可以作为DHCP中继代理的，我们作个实验来看一下设置方法。<br /><br />实验平台:3台安装了LINUX系统的服务器,一台为DHCP服务器Server,一台为router，做路由功能。一台做dhcprelay中继代理relay,二台用于测<br /><br />试的PC1和PC2。<br /><br />实验环境:分配三个网段:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br /><br />192.168.1.0/24<br />192.168.2.0/24<br /><br />作为route的服务器需要安装二个网卡，分别为:eth0;eth1。<br /><br />IP分配如下：<br /><br />eth0:192.168.1.254<br />eth1:192.168.2.254<br /><br />DHCP服务器Server1只需一张网卡，为:eth0<br /><br />eth0:192.168.1.1 网关指向：192.168.1.254<br /><br />要求用于测试的PC1,PC2,分别挂在二个网段中,最后实验的结果为,二个PC均获得所在网段的ip地址<br /><br />对DHCP服务器的配置:<br /><br />#vi /etc/dhcpd.conf<br /><br />引用:<br /><br />ddns-update-style interim;<br /><br />ignore client-updates;<br /><br />option subnet-mask&#160;&#160; 255.255.255.0;<br /><br />option domain-name&#160;&#160; “domain.org”;<br /><br /><br />default-lease-time 259200;<br /><br />max-lease-time 777600;<br /><br />option domain-name-servers 202.96.134.133,202.96.128.68;<br /><br />subnet 192.168.1.0 netmask 255.255.255.0 <br />{<br />option routers 192.168.10.1;<br />range dynamic-bootp 192.168.10.1 192.168.10.254;<br />}<br /><br />subnet 192.168.2.0 netmask 255.255.255.0&#160;&#160;&#160; //192.168.2.0/24<br />{ <br />option routers 192.168.20.1;<br />range dynamic-bootp 192.168.20.1 192.168.20.254;<br />}<br /><br />最后,我们使用下面的命令启动DHCP服务器:#service dhcpd start<br />有的人说起不来服务，不知道什么原因。没有遇到过、、<br /><br />DHCP服务器配置成功。<br /><br /><br /><br />下面我们将配置中LINUX为路由器，<br />#echo “1”&gt; /proc/sys/net/ipv4/ip_forward<br />配置linux有转发功能、<br />默认开机就变为0了。可以修改文件/etc/sysctl.conf。<br /><br /><br />下面配置dhccrealy<br /><br />首先要配置文件/etc/sysconfig/dhcrealy <br /><br />#vi /etc/sysconfig/dhcrealy<br />在里面输入:<br /><br />INTERFACES=”eth0″<br />DHCPSERVERS-”192.168.1.1″ #指向DHCP服务器<br /><br />下面启动dhcrelay<br />用pc1,pc2进行测试，查看结果.<br /><br /><br />备注：<br /><br />在虚拟做实验时，网卡设定虚拟网络如下：<br /><br />Server1的网卡eth0指向VMnet1 <br /><br />Server2的网卡eth0指向VMnet1，eth1指向VMnet2<br /><br />PC1的网卡指向VMnet1<br /><br />PC2的网卡指向VMnet2<br /><br />