title: 自动安装脚本
categories: [Shell编程]
tags: []
date: 2010-10-09 17:19:00
---
<p>LAMP自动安装脚本,为工作的时候，天天敲命令，autoinstall。</p><p>很垃圾的、没有什么华丽的语言、N年后，看看自己写的，能笑什么样、</p><p>安装程序就不拿出来了、代码如下：</p><p> </p><p>&lt;code&gt;</p><p> </p><p>#!/bin/sh</p><p>#autoinstall 自动安装脚本<br />#本脚本用于hrjd server安装使用<br />#跑去文档，傻瓜式安装。<br />#没有自动判断文件功能<br />#应该遵循文件名称，不然报错<br />#注意错误提示，及时排错<br />#所有安装文件必须放在/root/hrjd下面</p><p>#2010.10.09 by:key1088</p><p>#jiance code<br />ls /usr/cis7|grep server &gt; test1<br />ps aux|grep httpd|grep -v grep &gt;&gt; test1<br />if [ -s test1 ];then<br />rm -f test1<br />echo -e &quot; 33[31m----------------jiance-------------- 33[0m&quot;<br />echo -e &quot; 33[33m------server----- 33[0m&quot;<br />ps aux|grep server|grep -v grep<br />echo -e &quot; 33[33m------lowlessip----- 33[0m&quot;<br />ps aux|grep lowlessip|grep -v grep <br />echo -e &quot; 33[33m------guard----- 33[0m&quot;<br />ps aux|grep guard|grep -v grep<br />echo -e &quot; 33[33m------httpd port----- 33[0m&quot;<br />netstat -an|grep :80<br />echo -e &quot; 33[33m------mysql port----- 33[0m&quot;<br />netstat -an|grep :3306<br />echo -e &quot; 33[33m------mode----- 33[0m&quot;<br />lsmod |grep blackwhite<br />echo -e &quot; 33[33m------mybridge----- 33[0m&quot;<br />ifconfig mybridge|grep &quot;inet addr:&quot;<br />echo -e &quot; 33[31m----------------jiance-------------- 33[0m&quot;<br />exit<br />fi<br />#setup code<br />cd /root/hrjd/<br />printf &quot;Start Auto Install hrjd Server SoftWare&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   33[32m[ok] 33[0mn&quot;<br />printf &quot; 33[32m----------------bridge setuping------------------- 33[0mn&quot;<br />tar zxvf bridge-utils-1.0.6.tar.gz<br />cd bridge-utils-1.0.6<br />printf &quot; 33[32m----------------configure --prefix=/usr------------------- 33[0mn&quot;<br />./configure --prefix=/usr<br />printf &quot; 33[32m----------------make------------------- 33[0mn&quot;<br />make<br />printf &quot; 33[32m----------------make install------------------- 33[0mn&quot;<br />make install<br />printf &quot; 33[32m----------------make done------------------- 33[0mn&quot;<br />cd /etc/sysconfig/network-scripts/<br />if [ -f ifcfg-eth0 ]; then<br />echo &quot;DEVICE=eth0&quot; &gt; ifcfg-eth0<br />echo &quot;ONBOOT=yes&quot; &gt;&gt; ifcfg-eth0<br />echo &quot;TYPE=Ethernet&quot; &gt;&gt; ifcfg-eth0<br />echo &quot;BRIDGE=mybridge&quot; &gt;&gt; ifcfg-eth0<br />echo -e &quot; 33[32mifcfg-eth0 config ok 33[0m&quot;<br />fi<br />if [ -f ifcfg-eth1 ]; then<br />echo &quot;DEVICE=eth1&quot; &gt; ifcfg-eth1<br />echo &quot;ONBOOT=yes&quot; &gt;&gt; ifcfg-eth1<br />echo &quot;TYPE=Ethernet&quot; &gt;&gt; ifcfg-eth1<br />echo &quot;BRIDGE=mybridge&quot; &gt;&gt; ifcfg-eth1<br />echo -e &quot; 33[32mifcfg-eth1 config ok 33[0m&quot;<br />fi<br />if [ -f ifcfg-eth2 ]; then<br />echo &quot;DEVICE=eth2&quot; &gt; ifcfg-eth2<br />echo &quot;ONBOOT=yes&quot; &gt;&gt; ifcfg-eth2<br />echo &quot;TYPE=Ethernet&quot; &gt;&gt; ifcfg-eth2<br />echo &quot;BRIDGE=mybridge&quot; &gt;&gt; ifcfg-eth2<br />echo -e &quot; 33[32mifcfg-eth2 config ok 33[0m&quot;<br />fi<br />if [ -f ifcfg-eth3 ]; then<br />echo &quot;DEVICE=eth3&quot; &gt; ifcfg-eth3<br />echo &quot;ONBOOT=yes&quot; &gt;&gt; ifcfg-eth3<br />echo &quot;TYPE=Ethernet&quot; &gt;&gt; ifcfg-eth3<br />echo &quot;BRIDGE=mybridge&quot; &gt;&gt; ifcfg-eth3<br />echo -e &quot; 33[32mifcfg-eth3 config ok 33[0m&quot;<br />fi<br />if [ -f ifcfg-eth4 ]; then<br />echo &quot;DEVICE=eth4&quot; &gt; ifcfg-eth4<br />echo &quot;ONBOOT=yes&quot; &gt;&gt; ifcfg-eth4<br />echo &quot;TYPE=Ethernet&quot; &gt;&gt; ifcfg-eth4<br />echo &quot;BRIDGE=mybridge&quot; &gt;&gt; ifcfg-eth5<br />echo -e &quot; 33[32mifcfg-eth4 config ok 33[0m&quot;<br />fi<br />if [ -f ifcfg-eth5 ]; then<br />echo &quot;DEVICE=eth5&quot; &gt; ifcfg-eth5<br />echo &quot;ONBOOT=yes&quot; &gt;&gt; ifcfg-eth5<br />echo &quot;TYPE=Ethernet&quot; &gt;&gt; ifcfg-eth5<br />echo &quot;BRIDGE=mybridge&quot; &gt;&gt; ifcfg-eth5<br />echo -e &quot; 33[32mifcfg-eth5 config ok 33[0m&quot;<br />fi<br />echo &quot;DEVICE=mybridge&quot; &gt; ifcfg-mybridge<br />echo &quot;BOOTPROTO=static&quot; &gt;&gt; ifcfg-mybridge<br />echo &quot;ONBOOT=yes&quot; &gt;&gt; ifcfg-mybridge<br />echo &quot;TYPE=Bridge&quot; &gt;&gt; ifcfg-mybridge<br />echo &quot;NETMASK=255.255.255.0&quot; &gt;&gt; ifcfg-mybridge<br />echo &quot;IPADDR=192.168.0.204&quot; &gt;&gt; ifcfg-mybridge<br />echo &quot;GATEWAY=192.168.0.1&quot; &gt;&gt; ifcfg-mybridge<br />echo &quot;STP=on&quot; &gt;&gt; ifcfg-mybridge<br />if [ -f ifcfg-mybridge ]; then<br />echo -e &quot; 33[32mifcfg-mybridge config ok 33[0m&quot;<br />fi<br />printf &quot; 33[32m----------------bridge Done------------------- 33[0mn&quot;<br />cd /root/hrjd<br />printf &quot; 33[32m----------------MySql Setup------------------- 33[0mn&quot;<br />cp my.cnf /etc/my.cnf<br />rpm -ivh mysql-client-5.0.22-0.i386.rpm<br />sleep 1<br />rpm -ivh mysql-devel-5.0.22-0.i386.rpm<br />sleep 1<br />rpm -ivh mysql-shared-5.0.22-0.i386.rpm<br />sleep 1<br />rpm -ivh mysql-server-5.0.22-0.i386.rpm<br />ps aux|grep mysql|grep -v grep &gt; test1<br />if [ -s test1 ];then<br />echo -e &quot; 33[32m----mysql runing ok---- 33[0mn&quot;<br />mysqladmin -u root password 123<br />mysql -uroot -p123 -e &quot;grant all on *.* to <a>'root'@'%'</a> identified by '123'&quot;<br />mysql -uroot -p123 -e &quot;flush privileges&quot;<br />iptables -F<br />rm -r test1<br />echo -e &quot; 33[32m----------------MySql Setup Done-------------- 33[0mn&quot;<br />else<br />echo -e &quot; 33[31m----mysql no runing---- 33[0mn&quot;<br />echo -e &quot; 33[31m----mysql Setup error&quot;<br />fi<br />printf &quot; 33[32m---------------Apache Setup------------------- 33[0mn&quot;<br />tar zxvf httpd-2.2.9.tar.gz<br />cd httpd-2.2.9<br />printf &quot; 33[32m------------Apache ./config------------------- 33[0mn&quot;<br />./configure --prefix=/usr/local/apache2 --enable-so -enable-rewrite<br />printf &quot; 33[32m----------------Apache make------------------- 33[0mn&quot;<br />make<br />printf &quot; 33[32m----------Apache make install----------------- 33[0mn&quot;<br />make install<br />cd /root/hrjd<br />cp -a ruqinjiance/ /usr/local/apache2/htdocs/<br />mv /usr/local/apache2/conf/httpd.conf /usr/local/apache2/conf/httpd.conf.bak<br />cp -a httpd.conf /usr/local/apache2/conf/httpd.conf<br />printf &quot; 33[32m-------------Apache Setup Done---------------- 33[0mn&quot;<br />printf &quot; 33[32m-----------------PHP Setup-------------------- 33[0mn&quot;<br />tar zxvf php-5.2.11.tar.gz<br />cd php-5.2.11<br />printf &quot; 33[32m----------------PHP ./config ----------------- 33[0mn&quot;<br />./configure --prefix=/usr/local/php5 --with-apxs2=/usr/local/apache2/bin/apxs --with-mysql=/usr/bin/mysql --with-config-file-path=/usr/local/apache2/conf --enable-sockets<br />make<br />make install<br />cd /root/hrjd<br />mv /usr/local/php5/php.ini /usr/local/php5/php.ini.bak<br />cp php.ini /usr/local/php5/php.ini<br />printf &quot; 33[32m----------------PHP Setup Done----------------- 33[0mn&quot;<br />printf &quot; 33[32m---------------HRJD SERVER Setup--------------- 33[0mn&quot;<br />cp /root/hrjd/hrjd.tar /usr/hrjd.tar<br />cd /usr<br />tar xvf hrjd.tar<br />cd /root/hrjd<br />chmod 755 rc.local<br />mv /etc/rc.d/rc.local /etc/rc.d/rc.local.bak<br />cp /root/hrjd/rc.local /etc/rc.d/rc.local<br />ls /dev/|grep hda &gt; test1<br />if [ -s test1 ];then<br />echo -e &quot; 33[32m------------IDE HD ID--------------&quot;<br />hdparm -i /dev/hda|grep SerialNo <br />echo -e &quot;------------IDE HD ID-------------- 33[0m&quot;<br />rm -rf test1<br />else<br />chmod 777 sata<br />echo -e &quot; 33[32m------------SAST HD ID--------------&quot;<br />./sata<br />echo -e &quot;------------SAST HD ID-------------- 33[0m&quot;<br />fi<br />printf &quot;HRJD Server setup ok&quot;<br />getchar() {<br />&nbsp;&nbsp;&nbsp;  stty cbreak -echo<br />&nbsp;&nbsp;&nbsp;  dd if=/dev/tty bs=1 count=1
2&gt; /dev/null<br />&nbsp;&nbsp;&nbsp;  stty -cbreak echo<br />}<br />printf &quot; 33[32m-----------------press any key reboot----------------- 33[0m&quot;<br />ret=`getchar`<br />echo<br />reboot</p><p>&lt;/code&gt;</p>