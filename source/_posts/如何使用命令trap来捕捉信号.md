title: 如何使用命令trap来捕捉信号
categories: [Shell编程]
tags: []
date: 2010-08-18 09:31:00
---
　　它有三种形式分别对应三种不同的信号回应方式.<br />第一种:<br />trap &quot;commands&quot; signal-list<br />trap &quot;commands&quot; 数字<br />当脚本收到signal-list清单内列出的信号时,trap命令执行双引号中的命令.<br />第二种:<br />trap signal-list<br />trap不指定任何命令,接受信号的默认操作.默认操作是结束进程的运行.<br />第三种:<br />trap &quot;&quot; &quot;&quot; signal-list<br />trap命令指定一个空命令串,允许忽视信号.<br />Linux信号简介<br />1) SIGHUP 本信号在用户终端连接(正常或非正常)结束时发出, 通常是在终端的控制进程结束时, 通知同一session内的各个作业, 这时它们与控制终端不再关联.<br />2) SIGINT 程序终止(interrupt)信号, 在用户键入INTR字符(通常是Ctrl-C)时发出<br />3) SIGQUIT 和SIGINT类似, 但由QUIT字符(通常是Ctrl-)来控制. 进程在因收到SIGQUIT退出时会产生core文件, 在这个意义上类似于一个程序错误信号.<br />4) SIGILL 执行了非法指令. 通常是因为可执行文件本身出现错误, 或者试图执行数据段. 堆栈溢出时也有可能产生这个信号.<br />5) SIGTRAP 由断点指令或其它trap指令产生. 由debugger使用.<br />6) SIGABRT 程序自己发现错误并调用abort时产生.<br />7) SIGIOT 在PDP-11上由iot指令产生, 在其它机器上和SIGABRT一样.<br />8) SIGBUS 非法地址, 包括内存地址对齐(alignment)出错. eg: 访问一个四个字长的整数, 但其地址不是4的倍数.<br />9) SIGFPE 在发生致命的算术运算错误时发出. 不仅包括浮点运算错误, 还包括溢出及除数为0等其它所有的算术的错误.<br />10) SIGKILL 用来立即结束程序的运行. 本信号不能被阻塞, 处理和忽略.<br />11) SIGUSR1 留给用户使用<br />12) SIGSEGV 试图访问未分配给自己的内存, 或试图往没有写权限的内存地址写数据.<br />13) SIGUSR2 留给用户使用<br />14) SIGPIPE Broken pipe<br />15) SIGALRM 时钟定时信号, 计算的是实际的时间或时钟时间. alarm函数使用该信号.<br />16) SIGTERM 程序结束(terminate)信号, 与SIGKILL不同的是该信号可以被阻塞和处理. 通常用来要求程序自己正常退出. shell命令kill缺省产生这个信号.<br />17) SIGCHLD 子进程结束时, 父进程会收到这个信号.<br />18) SIGCONT 让一个停止(stopped)的进程继续执行. 本信号不能被阻塞. 可以用一个handler来让程序在由stopped状态变为继续执行时完成特定的工作. 例如, 重新显示提示符<br />19) SIGSTOP 停止(stopped)进程的执行. 注意它和terminate以及interrupt的区别: 该进程还未结束, 只是暂停执行. 本信号不能被阻塞, 处理或忽略.<br />20) SIGTSTP 停止进程的运行, 但该信号可以被处理和忽略. 用户键入SUSP字符时(通常是Ctrl-Z)发出这个信号<br />21) SIGTTIN 当后台作业要从用户终端读数据时, 该作业中的所有进程会收到SIGTTIN信号. 缺省时这些进程会停止执行.<br />22) SIGTTOU 类似于SIGTTIN, 但在写终端(或修改终端模式)时收到.<br />23) SIGURG 有紧急数据或out-of-band数据到达socket时产生.<br />24) SIGXCPU 超过CPU时间资源限制. 这个限制可以由getrlimit/setrlimit来读取/改变<br />25) SIGXFSZ 超过文件大小资源限制.<br />26) SIGVTALRM 虚拟时钟信号. 类似于SIGALRM, 但是计算的是该进程占用的CPU时间.<br />27) SIGPROF 类似于SIGALRM/SIGVTALRM, 但包括该进程用的CPU时间以及系统调用的时间.<br />28) SIGWINCH 窗口大小改变时发出.<br />29) SIGIO 文件描述符准备就绪, 可以开始进行输入/输出操作.<br />30) SIGPWR Power failure