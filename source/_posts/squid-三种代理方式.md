title: squid 三种代理方式
categories: [Linux]
tags: []
date: 2011-09-01 17:44:00
---
<p>Squid是一种在Linux系统下使用的优秀的代理服务器软件，很多时候都用到它。代理性能也很棒。</p><p>官方：<a href="http://www.squid-cache.org">www.squid-cache.org</a></p><p>开始吧：</p><p>by:key1088</p><p>squid代理分为三种</p><p>1.传统代理</p><p>2.透明代理</p><p>3.反向代理（web加速）</p><p>&nbsp;</p><p>下面一一简单讲解，也便于自己以后记忆,网上很多教程都是过时的，建议还是去官方看看权威的。</p><p>&nbsp;</p><p>squid在那？官方下载。</p><p>我用的是squid-3.0.STABLE25</p><p>tar xvf squid-3.0.STABLE25.tar.gz</p><p>cd squid-3.0.STABLE25</p><p>./configure --prefix=/usr/local/squid&nbsp; --enable-linux-tproxy --enable-linux-netfilter --localstatedit=/cache</p><p>make</p><p>make install</p><p>1.传统代理</p><p>客户端浏览器 修改代理端口</p><p>http_port 3128&nbsp;&nbsp; </p><p>2.透明代理</p><p>要使用透明代理，编译的时候必须添加--enable-linux-tproxy --enable-linux-netfilter</p><p>图：<br />&nbsp;&nbsp; 192.168.2.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.20.0<br />clent -----&gt;eth0-[linux]-eth1-------</p><p>透明代理就是用防火墙把访问80的数据重定向到squid代理端口上面</p><p>iptables 端口转发只能在nat上面设置</p><p>所以我们要使用SNAT</p><p>客户端设置：</p><p>网关：squid服务器的ip</p><p>DNS:正常DNS</p><p>服务器：</p><p>首先开启透明模式</p><p>http_port 3128 transparent</p><p>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p><p>用iptables开启NAT转换，现在客户端就能上网了。</p><p>iptables -t nat -A POSTROUTING -s 192.168.2.0/24 -o eth1 -j SNAT --to 192.168.20.128</p><p>端口转发80--&gt;3128</p><p>iptables -t nat -A PREROUTING -s 192.168.2.0/24 -p tcp --dport 80 -j REDIRECT --to-ports 3128</p><p>3.反向代理(web加速)</p><p>用squid 为web服务器（&nbsp;apache nginx lighttpd）提供加速</p><p>写主要的配置</p><p>一个站点的时候：</p><p>cache_peer 127.0.0.1 patent 80 0 no-query originserver<br />http_port 192.168.2.1:80&nbsp; accel defaultsite=192.168.2.1 </p><p>&nbsp;</p><p>apache：</p><p>listen 127.0.0.1:80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #这样和192.168.2.1:80不冲突</p><p>如果是其他的web server。监听127.0.0.1就可以</p><p>同服务器多个站点</p><p>Virtual Host :</p><p>acl our_sites dstdomain&nbsp;<a href="http://www.shoujizt.com/">www.shoujizt.com</a> wap.shoujizt.com</p><p>cache_peer_access myAccel allow our_sites<br />cache_peer_access myAccel deny all<br />cache_peer 127.0.0.1 parent 80 0 no-query originserver name=myAccel login=PASS</p><p>http_port 192.168.2.1:80 accel vhost</p><p>更多的反向代理配置详细请看</p><p><a href="http://wiki.squid-cache.org/ConfigExamples">http://wiki.squid-cache.org/ConfigExamples</a>&nbsp; Reverse Proxy (Acceleration)</p><p>以上就是三种代理方式，只是把主要用到的东西写上去，大体框架就是这些。</p><p>上面配置都是写上去的，难免有错误。如有什么错误，及改正请给予留言。</p><p>&nbsp;</p>